syntax = "proto3";

package proto.api;
option go_package = "github.com/d4l-data4life/grpc-modules/pkg/research-pillars/api";

import "google/api/annotations.proto";
import "google/api/httpbody.proto";
import "google/protobuf/struct.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "research-pillars/types.proto";

// clang-format off
option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    title: "Research Pillars API";
    version: "1.0";
    contact: {
      name: "Research Enablement Team";
      url: "https://data4life.care";
    };
  };
};
// clang-format on

/////////////////////////////////////////////////////////
// Users
/////////////////////////////////////////////////////////

service Users {
  rpc GetSelf(GetSelfRequest) returns (GetSelfResponse) {
    option (google.api.http) = {
      get : "/users/self"
    };
  }

  rpc GetUsers(GetUsersRequest) returns (GetUsersResponse) {
    option (google.api.http) = {
      get : "/users"
    };
  }

  rpc DeleteUser(DeleteUserRequest)
      returns (DeleteUserResponse) {
    option (google.api.http) = {
      delete : "/users/{userEmail}",
    };
  }

  rpc UpsertProgramRole(UpsertProgramRoleRequest)
      returns (UpsertProgramRoleResponse) {
    option (google.api.http) = {
      post : "/users/roles",
      body : "programRole"
    };
  }

  rpc DeleteProgramRole(DeleteProgramRoleRequest)
      returns (DeleteProgramRoleResponse) {
    option (google.api.http) = {
      delete : "/users/{userEmail}/role/{programName}",
    };
  }

  rpc GetBlockedPrograms(GetBlockedProgramsRequest)
      returns (GetBlockedProgramsResponse) {
    option (google.api.http) = {
      get : "/users/blocked-programs"
    };
  }

  rpc BlockProgram(BlockProgramRequest) returns (BlockProgramResponse) {
    option (google.api.http) = {
      post : "/users/blocked-program/{programName}",
    };
  }

  rpc UnblockProgram(UnblockProgramRequest) returns (UnblockProgramResponse) {
    option (google.api.http) = {
      delete : "/users/blocked-program",
    };
  }
}

message GetSelfRequest {}
message GetSelfResponse { User user = 1; }

message GetUsersRequest {}
message GetUsersResponse { repeated User users = 1; }

message DeleteUserRequest { string userEmail = 1; }
message DeleteUserResponse {}

message UpsertProgramRoleRequest { ProgramRole programRole = 1; }
message UpsertProgramRoleResponse {}

message DeleteProgramRoleRequest {
  string userEmail = 1;
  string programName = 2;
}
message DeleteProgramRoleResponse {}

message GetBlockedProgramsRequest {}
message GetBlockedProgramsResponse {
  repeated BlockedProgram blockedPrograms = 1;
}

message BlockProgramRequest { string programName = 1; }
message BlockProgramResponse {}

message UnblockProgramRequest {}
message UnblockProgramResponse {}

/////////////////////////////////////////////////////////
// Programs
/////////////////////////////////////////////////////////

service Programs {
  rpc GetPrograms(GetProgramsRequest) returns (GetProgramsResponse) {
    option (google.api.http) = {
      get : "/programs"
    };
  }

  rpc GetProgramsList(GetProgramsListRequest)
      returns (GetProgramsListResponse) {
    option (google.api.http) = {
      get : "/programslist"
    };
  }

  rpc IsNameAvailable(IsNameAvailableRequest) returns (IsNameAvailableResponse) {
    option (google.api.http) = {
      get : "/programslist/{name}"
    };
  }

  rpc GetProgram(GetProgramRequest) returns (GetProgramResponse) {
    option (google.api.http) = {
      get : "/programs/{name}"
    };
  }

  rpc GetProgramData(GetProgramDataRequest) returns (GetProgramDataResponse) {
    option (google.api.http) = {
      get : "/programs/{name}/data"
    };
  }

  rpc GetProgramDiffs(GetProgramDiffsRequest) returns (GetProgramDiffsResponse) {
    option (google.api.http) = {
      get : "/programs/{name}/diffs"
    };
  }

  rpc UpsertProgram(UpsertProgramRequest) returns (UpsertProgramResponse) {
    option (google.api.http) = {
      post : "/programs",
      body : "*"
    };
  }

  rpc DeleteProgram(DeleteProgramRequest) returns (DeleteProgramResponse) {
    option (google.api.http) = {
      delete : "/programs/{name}"
    };
  }

  rpc PublishProgram(PublishProgramRequest) returns (PublishProgramResponse) {
    option (google.api.http) = {
      post : "/programs/{name}/publish",
      body : "forTesting"
    };
  }

  rpc LoadProgram(LoadProgramRequest) returns (LoadProgramResponse) {
    option (google.api.http) = {
      post : "/programs/{name}/load",
    };
  }
}

message GetProgramsRequest {}
message GetProgramsResponse { repeated google.protobuf.Struct programs = 1; }

message GetProgramsListRequest {}
message GetProgramsListResponse { repeated string programNames = 1; }

message IsNameAvailableRequest { string name = 1; }
message IsNameAvailableResponse {
  bool available = 1;
}

message GetProgramRequest { string name = 1; }
message GetProgramResponse {
  google.protobuf.Struct program = 1;
  repeated Diff diffs = 2;
}

message GetProgramDataRequest { string name = 1; }
message GetProgramDataResponse {
  google.protobuf.Struct program = 1;
  repeated google.protobuf.Struct surveys = 2;
  repeated Questionnaire questionnaires = 3;
  repeated google.protobuf.Struct consents = 4;
  repeated google.protobuf.Struct routines = 5;
  repeated google.protobuf.Struct displays = 6;
}

message GetProgramDiffsRequest { string name = 1; }
message GetProgramDiffsResponse {
  repeated google.protobuf.Struct program = 1;
  repeated google.protobuf.Struct surveys = 2;
  repeated google.protobuf.Struct questionnaires = 3;
  repeated google.protobuf.Struct routines = 4;
  repeated google.protobuf.Struct displays = 5;
}

message UpsertProgramRequest {
  google.protobuf.Struct program = 1;
  google.protobuf.Struct change = 2;
}
message UpsertProgramResponse {}

message DeleteProgramRequest { string name = 1; }
message DeleteProgramResponse {}

message PublishProgramRequest {
  string name = 1;
  bool forTesting = 2;
}
message PublishProgramResponse {}

message LoadProgramRequest {
  string name = 1;
}
message LoadProgramResponse {}

/////////////////////////////////////////////////////////
// Surveys
/////////////////////////////////////////////////////////

service Surveys {
  rpc GetSurveys(GetSurveysRequest) returns (GetSurveysResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/surveys"
    };
  }

  rpc GetSurvey(GetSurveyRequest) returns (GetSurveyResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/surveys/{name}"
    };
  }

  rpc UpsertSurvey(UpsertSurveyRequest) returns (UpsertSurveyResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/surveys",
      body : "*"
    };
  }

  rpc DeleteSurvey(DeleteSurveyRequest) returns (DeleteSurveyResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/surveys/{name}"
    };
  }

  rpc PublishSurvey(PublishSurveyRequest) returns (PublishSurveyResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/surveys/{name}/publish",
    };
  }

  rpc LoadSurvey(LoadSurveyRequest) returns (LoadSurveyResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/surveys/{name}/load",
    };
  }
}

message GetSurveysRequest { string programName = 1; }
message GetSurveysResponse { repeated google.protobuf.Struct surveys = 1; }

message GetSurveyRequest {
  string programName = 1;
  string name = 2;
}
message GetSurveyResponse {
  google.protobuf.Struct survey = 1;
  repeated Diff diffs = 2;
}

message UpsertSurveyRequest {
  string programName = 1;
  google.protobuf.Struct survey = 2;
  google.protobuf.Struct change = 3;
}
message UpsertSurveyResponse {}

message DeleteSurveyRequest {
  string programName = 1;
  string name = 2;
}
message DeleteSurveyResponse {}

message PublishSurveyRequest {
  string programName = 1;
  string name = 2;
}
message PublishSurveyResponse {}

message LoadSurveyRequest {
  string programName = 1;
  string name = 2;
}
message LoadSurveyResponse {}

/////////////////////////////////////////////////////////
// Questionnaires
/////////////////////////////////////////////////////////

service Questionnaires {
  rpc GetQuestionnaires(GetQuestionnairesRequest)
      returns (GetQuestionnairesResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/questionnaires"
    };
  }

  rpc GetQuestionnaire(GetQuestionnaireRequest)
      returns (GetQuestionnaireResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/questionnaires/{name}"
    };
  }

  rpc UpsertQuestionnaire(UpsertQuestionnaireRequest)
      returns (UpsertQuestionnaireResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/questionnaires",
      body : "*"
    };
  }

  rpc DeleteQuestionnaire(DeleteQuestionnaireRequest)
      returns (DeleteQuestionnaireResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/questionnaires/{name}"
    };
  }

  rpc PublishQuestionnaire(PublishQuestionnaireRequest)
      returns (PublishQuestionnaireResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/questionnaires/{name}/publish",
    };
  }

  rpc LoadQuestionnaire(LoadQuestionnaireRequest)
      returns (LoadQuestionnaireResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/questionnaires/{name}/load",
    };
  }
}

message GetQuestionnairesRequest { string programName = 1; }
message GetQuestionnairesResponse { repeated Questionnaire questionnaires = 1; }

message GetQuestionnaireRequest {
  string programName = 1;
  string name = 2;
}
message GetQuestionnaireResponse {
  Questionnaire questionnaire = 1;
  repeated Diff diffs = 2;
}

message UpsertQuestionnaireRequest {
  string programName = 1;
  Questionnaire questionnaire = 2;
  google.protobuf.Struct change = 3;
}
message UpsertQuestionnaireResponse {}

message DeleteQuestionnaireRequest {
  string programName = 1;
  string name = 2;
}
message DeleteQuestionnaireResponse {}

message PublishQuestionnaireRequest {
  string programName = 1;
  string name = 2;
}
message PublishQuestionnaireResponse {}

message LoadQuestionnaireRequest {
  string programName = 1;
  string name = 2;
}
message LoadQuestionnaireResponse {}

/////////////////////////////////////////////////////////
// Routines
/////////////////////////////////////////////////////////

service Routines {
  rpc GetRoutines(GetRoutinesRequest) returns (GetRoutinesResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/routines"
    };
  }

  rpc GetRoutine(GetRoutineRequest) returns (GetRoutineResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/routines/{name}"
    };
  }

  rpc UpsertRoutine(UpsertRoutineRequest) returns (UpsertRoutineResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/routines",
      body : "*"
    };
  }

  rpc DeleteRoutine(DeleteRoutineRequest) returns (DeleteRoutineResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/routines/{name}"
    };
  }

  rpc PublishRoutine(PublishRoutineRequest) returns (PublishRoutineResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/routines/{name}/publish",
    };
  }

  rpc LoadRoutine(LoadRoutineRequest) returns (LoadRoutineResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/routines/{name}/load",
    };
  }
}

message GetRoutinesRequest { string programName = 1; }
message GetRoutinesResponse { repeated google.protobuf.Struct routines = 1; }

message GetRoutineRequest {
  string programName = 1;
  string name = 2;
}
message GetRoutineResponse {
  google.protobuf.Struct routine = 1;
  repeated Diff diffs = 2;
}

message UpsertRoutineRequest {
  string programName = 1;
  google.protobuf.Struct routine = 2;
  google.protobuf.Struct change = 3;
}
message UpsertRoutineResponse {}

message DeleteRoutineRequest {
  string programName = 1;
  string name = 2;
}
message DeleteRoutineResponse {}

message PublishRoutineRequest {
  string programName = 1;
  string name = 2;
}
message PublishRoutineResponse {}

message LoadRoutineRequest {
  string programName = 1;
  string name = 2;
}
message LoadRoutineResponse {}

/////////////////////////////////////////////////////////
// Displays
/////////////////////////////////////////////////////////

service Displays {
  rpc GetDisplays(GetDisplaysRequest) returns (GetDisplaysResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/displays"
    };
  }

  rpc GetDisplay(GetDisplayRequest) returns (GetDisplayResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/displays/{name}"
    };
  }

  rpc UpsertDisplay(UpsertDisplayRequest) returns (UpsertDisplayResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/displays",
      body : "*"
    };
  }

  rpc DeleteDisplay(DeleteDisplayRequest) returns (DeleteDisplayResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/displays/{name}"
    };
  }

  rpc PublishDisplay(PublishDisplayRequest) returns (PublishDisplayResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/displays/{name}/publish",
    };
  }

  rpc LoadDisplay(LoadDisplayRequest) returns (LoadDisplayResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/displays/{name}/load",
    };
  }
}

message GetDisplaysRequest { string programName = 1; }
message GetDisplaysResponse { repeated google.protobuf.Struct displays = 1; }

message GetDisplayRequest {
  string programName = 1;
  string name = 2;
}
message GetDisplayResponse {
  google.protobuf.Struct display = 1;
  repeated Diff diffs = 2;
}

message UpsertDisplayRequest {
  string programName = 1;
  google.protobuf.Struct display = 2;
  google.protobuf.Struct change = 3;
}
message UpsertDisplayResponse {}

message DeleteDisplayRequest {
  string programName = 1;
  string name = 2;
}
message DeleteDisplayResponse {}

message PublishDisplayRequest {
  string programName = 1;
  string name = 2;
}
message PublishDisplayResponse {}

message LoadDisplayRequest {
  string programName = 1;
  string name = 2;
}
message LoadDisplayResponse {}

/////////////////////////////////////////////////////////
// Participant Codes
/////////////////////////////////////////////////////////

service ParticipantCodes {
  rpc GetCodes(GetCodesRequest) returns (GetCodesResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/codes"
    };
  }

  rpc GenerateCodes(GenerateCodesRequest) returns (GenerateCodesResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/codes",
      body : "amount"
    };
  }

  rpc AssignCode(AssignCodeRequest) returns (AssignCodeResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/codes/{code}/assign",
      body : "alpID"
    };
  }

  rpc DeleteCode(DeleteCodeRequest) returns (DeleteCodeResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/codes/{code}",
    };
  }

  rpc UnassignCode(UnassignCodeRequest) returns (UnassignCodeResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/codes/{code}/assign",
    };
  }
}

message GetCodesRequest { string programName = 1; }
message GetCodesResponse { repeated ParticipantCode codes = 1; }

message GenerateCodesRequest { string programName = 1; int32 amount = 2; }
message GenerateCodesResponse {}

message AssignCodeRequest { string programName = 1; string code = 2; string alpID = 3; }
message AssignCodeResponse {}

message DeleteCodeRequest { string programName = 1; string code = 2; }
message DeleteCodeResponse {}

message UnassignCodeRequest { string programName = 1; string code = 2; }
message UnassignCodeResponse {}

/////////////////////////////////////////////////////////
// Consents
/////////////////////////////////////////////////////////

service Consents {
  rpc GetConsents(GetConsentsRequest) returns (GetConsentsResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/consents"
    };
  }

  rpc GetConsent(GetConsentRequest) returns (GetConsentResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/consents/{name}"
    };
  }

  rpc UpsertConsent(UpsertConsentRequest) returns (UpsertConsentResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/consents",
      body : "*"
    };
  }

  rpc DeleteConsent(DeleteConsentRequest) returns (DeleteConsentResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/consents/{name}",
    };
  }

  rpc DeleteConsentVersion(DeleteConsentVersionRequest) returns (DeleteConsentVersionResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/consents/{name}/{version}",
    };
  }

  rpc PublishConsent(PublishConsentRequest) returns (PublishConsentResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/consents/{name}/publish",
    };
  }
}

message GetConsentsRequest { string programName = 1; }
message GetConsentsResponse { repeated google.protobuf.Struct consents = 1; }

message GetConsentRequest {
  string programName = 1;
  string name = 2;
}
message GetConsentResponse {
  repeated google.protobuf.Struct consents = 1;
}

message UpsertConsentRequest {
  string programName = 1;
  google.protobuf.Struct consent = 2;
}
message UpsertConsentResponse {}

message DeleteConsentRequest {
  string programName = 1;
  string name = 2;
}
message DeleteConsentResponse {}

message DeleteConsentVersionRequest {
  string programName = 1;
  string name = 2;
  int32 version = 3;
}
message DeleteConsentVersionResponse {}

message PublishConsentRequest {
  string programName = 1;
  string name = 2;
}
message PublishConsentResponse {}

/////////////////////////////////////////////////////////
// Standalone Surveys
/////////////////////////////////////////////////////////

service StandaloneSurveys {
  rpc GetStandaloneSurveys(GetStandaloneSurveysRequest) returns (GetStandaloneSurveysResponse) {
    option (google.api.http) = {
      get : "/surveys"
    };
  }

  rpc GetStandaloneSurvey(GetStandaloneSurveyRequest) returns (GetStandaloneSurveyResponse) {
    option (google.api.http) = {
      get : "/surveys/{name}"
    };
  }

  rpc UpsertStandaloneSurvey(UpsertStandaloneSurveyRequest) returns (UpsertStandaloneSurveyResponse) {
    option (google.api.http) = {
      post : "/surveys",
      body : "*"
    };
  }

  rpc DeleteStandaloneSurvey(DeleteStandaloneSurveyRequest) returns (DeleteStandaloneSurveyResponse) {
    option (google.api.http) = {
      delete : "/surveys/{name}"
    };
  }
}

message GetStandaloneSurveysRequest { }
message GetStandaloneSurveysResponse { repeated google.protobuf.Struct surveys = 1; }

message GetStandaloneSurveyRequest {
  string name = 1;
}
message GetStandaloneSurveyResponse {
  google.protobuf.Struct survey = 1;
}

message UpsertStandaloneSurveyRequest {
  google.protobuf.Struct survey = 1;
}
message UpsertStandaloneSurveyResponse {}

message DeleteStandaloneSurveyRequest {
  string name = 1;
}
message DeleteStandaloneSurveyResponse {}

/////////////////////////////////////////////////////////
// Standalone Questionnaires
/////////////////////////////////////////////////////////

service StandaloneQuestionnaires {
  rpc GetStandaloneQuestionnaires(GetStandaloneQuestionnairesRequest)
      returns (GetStandaloneQuestionnairesResponse) {
    option (google.api.http) = {
      get : "/questionnaires"
    };
  }

  rpc GetStandaloneQuestionnaire(GetStandaloneQuestionnaireRequest)
      returns (GetStandaloneQuestionnaireResponse) {
    option (google.api.http) = {
      get : "/questionnaires/{name}"
    };
  }

  rpc UpsertStandaloneQuestionnaire(UpsertStandaloneQuestionnaireRequest)
      returns (UpsertStandaloneQuestionnaireResponse) {
    option (google.api.http) = {
      post : "/questionnaires",
      body : "*"
    };
  }

  rpc DeleteStandaloneQuestionnaire(DeleteStandaloneQuestionnaireRequest)
      returns (DeleteStandaloneQuestionnaireResponse) {
    option (google.api.http) = {
      delete : "/questionnaires/{name}"
    };
  }
}

message GetStandaloneQuestionnairesRequest {
  string language = 1;
}
message GetStandaloneQuestionnairesResponse {
  repeated google.protobuf.Struct questionnaires = 1;
}

message GetStandaloneQuestionnaireRequest {
  string name = 1;
  string language = 2;
}
message GetStandaloneQuestionnaireResponse {
  google.protobuf.Struct questionnaire = 1;
}

message UpsertStandaloneQuestionnaireRequest {
  google.protobuf.Struct questionnaire = 1;
}
message UpsertStandaloneQuestionnaireResponse {}

message DeleteStandaloneQuestionnaireRequest {
  string name = 1;
  optional string language = 2;
}
message DeleteStandaloneQuestionnaireResponse {}

/////////////////////////////////////////////////////////
// Uploads
/////////////////////////////////////////////////////////

service Uploads {
  rpc GetSubjects(GetSubjectsRequest) returns (GetSubjectsResponse) {
    option (google.api.http) = {
      get : "/uploads/subjects/{programName}"
    };
  }

  rpc GetSubjectData(GetSubjectDataRequest) returns (GetSubjectDataResponse) {
    option (google.api.http) = {
      get : "/uploads/subjects/{programName}/{subjectID}"
    };
  }

  rpc GetSubjectResource(GetSubjectResourceRequest) returns (GetSubjectResourceResponse) {
    option (google.api.http) = {
      get : "/uploads/subjects/{programName}/{subjectID}/{resourceID}"
    };
  }

  rpc GetDownloadList(GetDownloadListRequest) returns (GetDownloadListResponse) {
    option (google.api.http) = {
      get : "/download/{programName}",
    };
  }

  rpc GetDownloadTicket(GetDownloadTicketRequest) returns (GetDownloadTicketResponse) {
    option (google.api.http) = {
      post : "/download/{programName}",
      body : "*"
    };
  }

  rpc GetStatistics(GetStatisticsRequest) returns (GetStatisticsResponse) {
    option (google.api.http) = {
      get : "/statistics/{programName}/{type}"
    };
  }
}

message GetSubjectsRequest { string programName = 1; }
message GetSubjectsResponse { repeated google.protobuf.Struct subjects = 1; }

message GetSubjectDataRequest {
  string programName = 1;
  string subjectID = 2;
}
message GetSubjectDataResponse {
  repeated google.protobuf.Struct uploads = 1;
}

message GetSubjectResourceRequest {
  string programName = 1;
  string subjectID = 2;
  string resourceID = 3;
}
message GetSubjectResourceResponse {
  google.protobuf.Struct resource = 1;
}

message GetDownloadListRequest {
  string programName = 1;
}
message GetDownloadListResponse {
  repeated google.protobuf.Struct subjects = 1;
}

message GetDownloadTicketRequest {
  string programName = 1;
  repeated string subjectIDs = 2;
  bool includeRawFHIR = 3;
  bool includeETLCSV = 4;
}
message GetDownloadTicketResponse {
  string url = 1;
}

message GetStatisticsRequest {
  string programName = 1;
  string type = 2;
  optional string startDate = 3;
  optional string endDate = 4;
  google.protobuf.Struct params = 5;
}
message GetStatisticsResponse {
  google.protobuf.Struct data = 1;
}

/////////////////////////////////////////////////////////
// Images
/////////////////////////////////////////////////////////

service Images {
  rpc GetImage(GetImageRequest) returns (google.api.HttpBody) {
    option (google.api.http) = {
      get : "/programs/{programName}/images/{name}",
    };
  }

  rpc UpsertImage(UpsertImageRequest) returns (UpsertImageResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/images",
      body : "*"
    };
  }

  rpc DeleteImage(DeleteImageRequest) returns (DeleteImageResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/images/{name}",
    };
  }
}

message GetImageRequest {
  string programName = 1;
  string name = 2;
}

message UpsertImageRequest {
  string programName = 1;
  string name = 2;
  string contentType = 3;
  bytes data = 4;
}
message UpsertImageResponse {}

message DeleteImageRequest {
  string programName = 1;
  string name = 2;
}
message DeleteImageResponse {}

/////////////////////////////////////////////////////////
// Clients
/////////////////////////////////////////////////////////

service Clients {
  rpc GetClients(GetClientsRequest) returns (GetClientsResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/client",
    };
  }

  rpc GetClient(GetClientRequest) returns (GetClientResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/client/{name}",
    };
  }

  rpc UpsertClient(UpsertClientRequest) returns (UpsertClientResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/client",
      body : "*"
    };
  }

  rpc ExchangeToken(ExchangeTokenRequest) returns (ExchangeTokenResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/client/{name}/token",
      body : "*"
    };
  }

  rpc DeleteClient(DeleteClientRequest) returns (DeleteClientResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/client/{name}",
    };
  }
}

message GetClientsRequest {
  string programName = 1;
}

message GetClientsResponse {
  repeated Client clients = 1;
}

message GetClientRequest {
  string programName = 1;
  string name = 2;
}

message GetClientResponse {
  Client client = 1;
}

message UpsertClientRequest {
  string programName = 1;
  string name = 2;
  string clientID = 3;
  string clientSecret = 4;
}
message UpsertClientResponse {}

message ExchangeTokenRequest {
  string name = 1;
  string programName = 2;
  string clientID = 3;
  string clientSecret = 4;
  google.protobuf.Struct params = 5;
}
message ExchangeTokenResponse {
  google.protobuf.Struct body = 1;
}

message DeleteClientRequest {
  string programName = 1;
  string name = 2;
}
message DeleteClientResponse {}

/////////////////////////////////////////////////////////
// Messages
/////////////////////////////////////////////////////////

service Messages {
  rpc GetMessages(GetMessagesRequest) returns (GetMessagesResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/messages"
    };
  }

  rpc GetMessage(GetMessageRequest) returns (GetMessageResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/messages/{name}"
    };
  }

  rpc UpsertMessage(UpsertMessageRequest) returns (UpsertMessageResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/messages",
      body : "*"
    };
  }

  rpc DeleteMessage(DeleteMessageRequest) returns (DeleteMessageResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/messages/{name}"
    };
  }

  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse) {
    option (google.api.http) = {
      post : "/programs/{programName}/messages/{name}/send",
    };
  }

}

message GetMessagesRequest { string programName = 1; }
message GetMessagesResponse { repeated google.protobuf.Struct messages = 1; }

message GetMessageRequest {
  string programName = 1;
  string name = 2;
}
message GetMessageResponse {
  google.protobuf.Struct message = 1;
  repeated google.protobuf.Struct recipients = 2;
}

message UpsertMessageRequest {
  string programName = 1;
  google.protobuf.Struct message = 2;
}
message UpsertMessageResponse {}

message DeleteMessageRequest {
  string programName = 1;
  string name = 2;
}
message DeleteMessageResponse {}

message SendMessageRequest {
  string programName = 1;
  string name = 2;
}
message SendMessageResponse {}

/////////////////////////////////////////////////////////
// Device Token
/////////////////////////////////////////////////////////

service DeviceTokens {
  rpc GetTokens(GetTokensRequest) returns (GetTokensResponse) {
    option (google.api.http) = {
      get : "/programs/{programName}/devicetokens"
    };
  }

  rpc UpsertToken(UpsertTokenRequest) returns (UpsertTokenResponse) {
    option (google.api.http) = {
      put : "/programs/{programName}/devicetokens",
      body : "*"
    };
  }

  rpc DeleteToken(DeleteTokenRequest) returns (DeleteTokenResponse) {
    option (google.api.http) = {
      delete : "/programs/{programName}/devicetokens/{subjectID}",
    };
  }
}

message GetTokensRequest { string programName = 1; }
message GetTokensResponse { repeated DeviceToken tokens = 1; }

message UpsertTokenRequest { string programName = 1; string subjectID = 2; string token = 3; }
message UpsertTokenResponse {}

message DeleteTokenRequest { string programName = 1; string subjectID = 2; }
message DeleteTokenResponse {}

/////////////////////////////////////////////////////////
// Checks
/////////////////////////////////////////////////////////

service Checks {
  rpc Liveness(ChecksRequest) returns (ChecksResponse) {
    option (google.api.http) = {
      get : "/checks/liveness"
    };
  }

  rpc Readiness(ChecksRequest) returns (ChecksResponse) {
    option (google.api.http) = {
      get : "/checks/readiness"
    };
  }
}

message ChecksRequest {}
message ChecksResponse { string response = 1; }
